<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>공지 목록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <style>
        .table th a { text-decoration: none; color: inherit; }
        .sort-arrow { font-size: .8rem; margin-left: .25rem; }
    </style>
</head>
<body class="bg-light">
<div th:replace="~{fragments/common :: header(active='points')}"></div>
<div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h4 mb-0">공지 목록</h1>

        <!-- 표시 개수 선택 -->
        <form th:action="@{/notice}" method="get" class="d-flex align-items-center gap-2">
            <!-- A방식은 sort를 단일 파라미터로 유지해야 함 -->
            <input type="hidden" name="page" th:value="${page.number}">
            <input type="hidden" name="sort" th:value="${sort + ',' + dir}">
            <label class="form-label mb-0">
                표시:
                <select class="form-select form-select-sm d-inline-block w-auto" name="size"
                        onchange="this.form.submit()">
                    <option th:each="opt : ${new int[]{10,20,30,50}}"
                            th:value="${opt}" th:text="${opt}"
                            th:selected="${size == opt}">10</option>
                </select>
            </label>
        </form>
    </div>

    <div class="card">
        <div class="card-body p-0">
            <table class="table table-hover mb-0 align-middle">
                <thead class="table-light">
                <tr>
                    <!-- 번호(nBId) 정렬 -->
                    <th style="width:110px;">
                        <a th:href="@{/notice(
                          page=0,
                          size=${size},
                          sort=${'nBId,' + (sort=='nBId' && dir=='asc' ? 'desc' : 'asc')}
                        )}">
                            번호
                        </a>
                        <span class="sort-arrow"
                              th:if="${sort=='nBId'}"
                              th:text="${dir=='asc' ? '▲' : '▼'}"></span>
                    </th>

                    <th>제목</th>

                    <!-- 작성자(userNo) 정렬 -->
                    <th style="width:120px;">
                        <a th:href="@{/notice(
                          page=0,
                          size=${size},
                          sort=${'userNo,' + (sort=='userNo' && dir=='asc' ? 'desc' : 'asc')}
                        )}">
                            작성자
                        </a>
                        <span class="sort-arrow"
                              th:if="${sort=='userNo'}"
                              th:text="${dir=='asc' ? '▲' : '▼'}"></span>
                    </th>

                    <!-- 작성일(regDate) 정렬 -->
                    <th style="width:210px;">
                        <a th:href="@{/notice(
                          page=0,
                          size=${size},
                          sort=${'regDate,' + (sort=='regDate' && dir=='asc' ? 'desc' : 'asc')}
                        )}">
                            작성일
                        </a>
                        <span class="sort-arrow"
                              th:if="${sort=='regDate'}"
                              th:text="${dir=='asc' ? '▲' : '▼'}"></span>
                    </th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="n : ${page.content}">
                    <td th:text="${n.nBId}">1</td>
                    <td>
                        <a th:href="@{|/notice/${n.nBId}|}"
                           th:text="${n.nBTitle}">제목</a>
                    </td>
                    <td th:text="${n.userNo}">1</td>
                    <td th:text="${n.regDate != null ? #temporals.format(n.regDate,'yyyy-MM-dd HH:mm') : ''}">2025-09-23 11:20</td>
                </tr>

                <tr th:if="${#lists.isEmpty(page.content)}">
                    <td colspan="4" class="text-center text-muted py-4">데이터가 없습니다.</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- 페이지네이션 (10개 블록) -->
    <div class="d-flex justify-content-center mt-3">
        <nav>
            <ul class="pagination mb-0">
                <th:block th:with="
            curr=${page.number},
            total=${page.totalPages},
            blockSize=${10},
            start=${curr - (curr % blockSize)},
            end=${ (start + blockSize - 1) < (total - 1) ? (start + blockSize - 1) : (total - 1) }
        ">
                    <!-- 이전 블록 -->
                    <li class="page-item" th:classappend="${start <= 0} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{/notice(page=${start-1}, size=${size}, sort=${sort + ',' + dir})}">이전</a>
                    </li>

                    <!-- 번호들 -->
                    <li class="page-item"
                        th:each="p : ${#numbers.sequence(start, end)}"
                        th:classappend="${p == curr} ? 'active'">
                        <a class="page-link"
                           th:text="${p + 1}"
                           th:href="@{/notice(page=${p}, size=${size}, sort=${sort + ',' + dir})}">1</a>
                    </li>

                    <!-- 다음 블록 -->
                    <li class="page-item" th:classappend="${end >= total-1} ? 'disabled'">
                        <a class="page-link"
                           th:href="@{/notice(page=${end+1}, size=${size}, sort=${sort + ',' + dir})}">다음</a>
                    </li>
                </th:block>
            </ul>
        </nav>
    </div>

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
</body>
</html>
