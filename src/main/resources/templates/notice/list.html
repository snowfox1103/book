<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
  <meta charset="utf-8"/>
  <title>공지 목록</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" th:href="@{/css/common.css}">
  <style>
    .table thead th { white-space: nowrap; }
    .sort-link { text-decoration: none; }
    .sort-arrow { font-size: .85em; margin-left: .25rem; }
  </style>
</head>
<div th:replace="~{fragments/common :: header(active='board')}"></div>
<body class="bg-light">

<div class="container py-4">

  <!-- 상단 타이틀 + 작성 버튼(관리자 전용) -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="mb-0">공지 목록</h5>
    <a class="btn btn-primary"
       th:href="@{/notice/write}"
       sec:authorize="hasRole('ADMIN')">공지 작성</a>
  </div>

  <div class="table-responsive bg-white rounded shadow-sm">
    <table class="table align-middle mb-0">
      <thead>
      <tr>
        <!-- 번호 정렬 -->
        <th style="width: 100px;">
          <a class="sort-link"
             th:href="@{/notice(sort='nBId', dir=${(sort=='nBId' and dir=='asc') ? 'desc' : 'asc'})}"
             th:text="'번호'"></a>
          <span class="sort-arrow"
                th:text="${sort=='nBId' ? (dir=='asc' ? '▲' : '▼') : ''}"></span>
        </th>

        <!-- 제목 정렬 -->
        <th>
          <a class="sort-link"
             th:href="@{/notice(sort='nBTitle', dir=${(sort=='nBTitle' and dir=='asc') ? 'desc' : 'asc'})}"
             th:text="'제목'"></a>
          <span class="sort-arrow"
                th:text="${sort=='nBTitle' ? (dir=='asc' ? '▲' : '▼') : ''}"></span>
        </th>

        <!-- 작성자 정렬(필요 시 userNo 기준) -->
        <th style="width: 140px;">
          <a class="sort-link"
             th:href="@{/notice(sort='userNo', dir=${(sort=='userNo' and dir=='asc') ? 'desc' : 'asc'})}"
             th:text="'작성자'"></a>
          <span class="sort-arrow"
                th:text="${sort=='userNo' ? (dir=='asc' ? '▲' : '▼') : ''}"></span>
        </th>

        <!-- 작성일 정렬(엔티티 필드명에 맞춰 regDate 수정) -->
        <th style="width: 220px;">
          <a class="sort-link"
             th:href="@{/notice(sort='regDate', dir=${(sort=='regDate' and dir=='asc') ? 'desc' : 'asc'})}"
             th:text="'작성일'"></a>
          <span class="sort-arrow"
                th:text="${sort=='regDate' ? (dir=='asc' ? '▲' : '▼') : ''}"></span>
        </th>
      </tr>
      </thead>

      <tbody>
      <!-- 데이터가 없을 때 -->
      <tr th:if="${page.totalElements == 0}">
        <td colspan="4" class="text-center text-muted py-4">등록된 공지가 없습니다.</td>
      </tr>

      <!-- 데이터가 있을 때 -->
      <tr th:each="n : ${page.content}">
        <td th:text="${n.nBId}">1</td>
        <td>
          <a th:href="@{'/notice/' + ${n.nBId}}"
             th:text="${n.nBTitle}">제목</a>
        </td>
        <td th:text="${n.userNo}">1</td>
        <!-- regDate 포맷: 프로젝트의 필드명/타입에 맞게 포맷터 사용 -->
        <td th:text="${#temporals.format(n.regDate, 'yyyy-MM-dd HH:mm')}">2025-09-19 16:30</td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- 페이지네이션 -->
  <nav class="mt-3">
    <ul class="pagination justify-content-end">
      <li class="page-item" th:classappend="${page.first}? 'disabled'">
        <a class="page-link"
           th:href="@{/notice(page=${page.number-1}, size=${page.size}, sort=${sort}, dir=${dir})}">이전</a>
      </li>

      <li class="page-item active">
        <span class="page-link" th:text="${page.number + 1}">1</span>
      </li>

      <li class="page-item" th:classappend="${page.last}? 'disabled'">
        <a class="page-link"
           th:href="@{/notice(page=${page.number+1}, size=${page.size}, sort=${sort}, dir=${dir})}">다음</a>
      </li>
    </ul>
  </nav>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
