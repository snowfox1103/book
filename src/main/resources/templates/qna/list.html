<!doctype html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="utf-8">
    <title>Board List</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/header.css}">

    <style>
        /* ===== Simple Sidebar ===== */
        #wrapper {
            display: flex;
            width: 100%;
        }

        #sidebar-wrapper {
            min-height: 100vh;
            width: 240px;
            margin-left: 0;
            transition: margin .25s ease-out;
            border-right: 1px solid rgba(0, 0, 0, .1);
            background-color: #f8f9fa;
        }

        #page-content-wrapper {
            width: 100%;
        }

        /* 토글 시 사이드바 숨김 */
        #wrapper.toggled #sidebar-wrapper {
            margin-left: -240px;
        }

        .sidebar-heading {
            padding: 1rem 1.25rem;
            font-weight: 600;
        }

        .list-group-item {
            border: 0;
            border-radius: .375rem;
        }

        .list-group-item:hover {
            background: #eef2f7;
        }
    </style>
</head>
<body class="bg-light">

<!-- 공통 상단 -->
<div th:replace="~{fragments/nyjcommon :: header(active='board')}"></div>

<div id="wrapper">
    <!-- ===== Page content ===== -->
    <div id="page-content-wrapper">

        <!-- 페이지 제목/액션 -->
        <div class="bg-white border-bottom">
            <div class="container py-2 d-flex align-items-center justify-content-between">
                <h1 class="h5 mb-0">문의 목록</h1>
                <a class="btn btn-primary btn-sm" th:href="@{/qna/write}">새 문의</a>
            </div>
        </div>

        <!-- 실제 컨텐츠 -->
        <main class="container py-4">
            <div class="card shadow-sm">
                <div class="card-body p-0">
                    <table class="table table-hover mb-0 align-middle">
                        <thead class="table-light">
                        <tr>
                            <th style="width:80px">번호</th>
                            <th>제목</th>
                            <th style="width:140px">답변여부</th> <!-- ✅ 새 컬럼 -->
                            <th style="width:160px">작성자</th>
                            <th style="width:180px">작성일</th>
                            <th style="width:100px">공개</th>
                        </tr>
                        </thead>

                        <tbody>
                        <tr th:each="q : ${page.content}">
                            <!-- 번호 -->
                            <td th:text="${q.qBId}"></td>

                            <!-- 제목 -->
                            <td>
                                <a th:href="@{|/qna/${q.qBId}|}" th:text="${q.qBTitle}"></a>
                                <span class="badge bg-secondary ms-1" th:if="${q.qBBlind}">비공개</span>
                            </td>

                            <td th:with="answered=${answeredIds != null and answeredIds.contains(q.qBId)}">
  <span class="badge rounded-pill"
        th:classappend="${answered} ? ' bg-primary' : ' bg-secondary'"
        th:text="${answered} ? '답변완료' : '답변 대기중'"></span>
                            </td>


                            <!-- 작성자 -->
                            <td th:text="${q.writer.userId}">작성자</td>

                            <!-- 작성일 -->
                            <td th:text="${#temporals.format(q.regDate, 'yyyy-MM-dd HH:mm')}"></td>

                            <!-- 공개 -->
                            <td th:text="${q.qBBlind} ? '비공개' : '공개'"></td>
                        </tr>

                        <tr th:if="${#lists.isEmpty(page.content)}">
                            <td colspan="6" class="text-center text-muted py-4">등록된 글이 없습니다.</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- pagination -->
<nav aria-label="QnA pagination" class="mt-3">
    <ul class="pagination justify-content-center">

        <!-- 이전 -->
        <li class="page-item" th:classappend="${page.first} ? ' disabled'">
            <a class="page-link"
               th:href="@{/qna(page=${page.number - 1}, size=${page.size}, sort='regDate,desc')}"
               tabindex="-1">이전</a>
        </li>

        <!-- 페이지 번호 1..N -->
        <li class="page-item"
            th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
            th:classappend="${i == page.number} ? ' active'">
            <a class="page-link"
               th:text="${i + 1}"
               th:href="@{/qna(page=${i}, size=${page.size}, sort='regDate,desc')}"></a>
        </li>

        <!-- 다음 -->
        <li class="page-item" th:classappend="${page.last} ? ' disabled'">
            <a class="page-link"
               th:href="@{/qna(page=${page.number + 1}, size=${page.size}, sort='regDate,desc')}">다음</a>
        </li>
    </ul>
</nav>
<div th:replace="~{fragments/common :: alert}"></div>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    (function () {
        const btn = document.getElementById('sidebarToggle');
        const wrapper = document.getElementById('wrapper');
        if (btn && wrapper) {
            btn.addEventListener('click', function () {
                wrapper.classList.toggle('toggled');
            });
        }
    })();
</script>
</body>
</html>
