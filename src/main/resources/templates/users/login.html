<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
  <title>Simple Sidebar - Login</title>
  <!-- Favicon-->
  <link rel="icon" type="image/x-icon" th:href="@{/assets/favicon.ico}" />
  <!-- Core theme CSS (includes Bootstrap)-->
  <link th:href="@{/css/styles.css}" rel="stylesheet" />
</head>
<body class="align-middle" >
<div class="container-fluid d-flex justify-content-center" style="height:100vh">
  <div class="card align-self-center">
    <div class="card-header">
      LOGIN Page
    </div>
    <div class="card-body">
      <form id="registerForm" action="/users/login" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <div class="input-group mb-3">
          <span class="input-group-text">아이디</span>
          <input type="text" name="username" class="form-control" placeholder="USER ID">
        </div>
        <div class="input-group mb-3">
          <span class="input-group-text">패스워드</span>
<!--          일부러 text타입으로 지정, 확인을 위해-->
          <input type="text" name="password" class="form-control" placeholder="PASSWORD"> 
        </div>
        <div class="input-group mb-3">
          <input class="form-check-input" type="checkbox" name="remember-me">
          <label class="form-check-label">
            자동 로그인
          </label>
        </div>
        <div class="my-4">
          <div class="float-end">
            <button type="submit" class="btn btn-primary submitBtn">LOGIN</button>
          </div>
        </div>

        <script th:inline="javascript">
            const t = document.querySelector('meta[name="_csrf"]')?.content;
            const h = document.querySelector('meta[name="_csrf_header"]')?.content;
            const headers = {'Content-Type': 'application/json'};
            if (t && h) headers[h] = t;

            document.addEventListener('DOMContentLoaded', () => {
                const err = /*[[${param.error}]]*/ [];   // 없으면 []로 안전
                if (Array.isArray(err) && err.includes('disabled')) {
                    alert('이메일 인증 후에 로그인할 수 있습니다.');
                } else if (Array.isArray(err) && err.length) {
                    alert('아이디 또는 비밀번호가 잘못되었습니다.');
                }

                let message = [[${message}]];
                if (message) {
                    alert("가입 확인 메일을 보냈습니다.");
                }

                const msg = null;
                if (msg) {
                    alert(msg);
                }

                const loggedOut = /*[[${param.logout != null}]]*/ false;
                if (loggedOut) {
                    alert('로그아웃 되었습니다.');
                }
            });
        </script>
      </form>
      <div>
        <a href="/oauth2/authorization/kakao">KAKAO</a>
      </div>
      <div>
        <a href="/users/searchAndResend">ID/PW 찾기, 인증 다시 하기</a>
      </div>
    </div><!--end card body-->
  </div><!--end card-->
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>